# TypeScript con Next.js (App Router)

Next.js es un framework de React que simplifica la creación de aplicaciones web modernas con características como renderizado del lado del servidor (SSR), generación de sitios estáticos (SSG) y soporte nativo para TypeScript. En esta sección, aprenderás cómo configurar y usar TypeScript con la última versión de Next.js (App Router) para construir aplicaciones robustas.

## ¿Por qué usar TypeScript con Next.js?

- **Tipado seguro**: Detecta errores en tiempo de desarrollo.
- **Mejor DX**: Autocompletado y documentación en componentes y APIs.
- **Escalabilidad**: Ideal para proyectos grandes con equipos múltiples.
- **Soporte nativo**: Next.js incluye soporte integrado para TypeScript.

## Configuración de un Proyecto Next.js con TypeScript

Sigue estos pasos para crear un proyecto Next.js con TypeScript usando el App Router.

### 1. Crear un Proyecto Next.js

Ejecuta el siguiente comando para crear un proyecto con TypeScript:

```bash
npx create-next-app@latest mi-app-next --typescript --eslint --app --src-dir --tailwind --import-alias "@/*"
```

Selecciona las siguientes opciones cuando se te solicite:
- **Would you like to use TypeScript?** Sí
- **Would you like to use ESLint?** Sí
- **Would you like to use Tailwind CSS?** Sí (opcional, pero recomendado)
- **Would you like to use `src/` directory?** Sí
- **Would you like to use App Router?** Sí
- **Would you like to customize the default import alias?** Usa `@/*`

Esto genera un proyecto con una estructura optimizada y TypeScript preconfigurado.

### 2. Estructura del Proyecto

La estructura generada incluye:

```
mi-app-next/
├── src/
│   ├── app/
│   │   ├── page.tsx
│   │   ├── layout.tsx
│   │   ├── globals.css
│   ├── components/
├── public/
├── next.config.mjs
├── tsconfig.json
├── package.json
```

El archivo `tsconfig.json` ya está configurado con opciones recomendadas para Next.js, como:

```json
{
  "compilerOptions": {
    "target": "es5",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  }
}
```

### 3. Crear una Página con TypeScript

El App Router usa componentes de servidor por defecto. Edita `src/app/page.tsx`:

```typescript
import { NextPage } from "next";

interface Props {
  searchParams: { [key: string]: string | string[] | undefined };
}

const Home: NextPage<Props> = ({ searchParams }) => {
  const mensaje = (searchParams.mensaje as string) || "¡Bienvenido a Next.js con TypeScript!";

  return (
    <main className="flex min-h-screen flex-col items-center justify-center p-24">
      <h1 className="text-4xl font-bold">{mensaje}</h1>
    </main>
  );
};

export default Home;
```

- **Tipado**: Usamos `NextPage` para tipar el componente y `searchParams` para manejar parámetros de búsqueda.
- **Tailwind CSS**: Las clases de Tailwind están aplicadas para estilos rápidos.

### 4. Componentes de Servidor y Cliente

#### Componente de Servidor

Los componentes en el App Router son de servidor por defecto, lo que significa que se ejecutan en el servidor. Ejemplo en `src/app/about/page.tsx`:

```typescript
export default async function AboutPage() {
  // Simula una llamada a una API
  const datos = await fetch("https://jsonplaceholder.typicode.com/posts/1").then((res) => res.json());

  return (
    <div className="p-8">
      <h1 className="text-3xl font-bold">Acerca de</h1>
      <p>Título: {datos.title}</p>
    </div>
  );
}
```

#### Componente de Cliente

Para componentes interactivos, usa la directiva `"use client"`. Crea `src/components/Counter.tsx`:

```typescript
"use client";

import { useState } from "react";

interface CounterProps {
  initialCount?: number;
}

const Counter: React.FC<CounterProps> = ({ initialCount = 0 }) => {
  const [count, setCount] = useState(initialCount);

  return (
    <div className="p-4">
      <p>Contador: {count}</p>
      <button
        className="bg-blue-500 text-white px-4 py-2 rounded"
        onClick={() => setCount(count + 1)}
      >
        Incrementar
      </button>
    </div>
  );
};

export default Counter;
```

Úsalo en `src/app/page.tsx`:

```typescript
import Counter from "@/components/Counter";

interface Props {
  searchParams: { [key: string]: string | string[] | undefined };
}

const Home: NextPage<Props> = ({ searchParams }) => {
  const mensaje = (searchParams.mensaje as string) || "¡Bienvenido a Next.js con TypeScript!";

  return (
    <main className="flex min-h-screen flex-col items-center justify-center p-24">
      <h1 className="text-4xl font-bold">{mensaje}</h1>
      <Counter initialCount={5} />
    </main>
  );
};

export default Home;
```

### 5. API Routes con TypeScript

Crea una ruta API en `src/app/api/hello/route.ts`:

```typescript
import { NextResponse } from "next/server";

export async function GET(request: Request) {
  return NextResponse.json({ mensaje: "¡Hola desde la API con TypeScript!" });
}
```

- **Tipado**: `NextResponse` y `Request` están tipados para garantizar seguridad.
- Accede a esta ruta en `http://localhost:3000/api/hello`.

### 6. Tipado de Datos de API

Para tipar datos de una API, define una interfaz. Ejemplo en `src/app/api/posts/route.ts`:

```typescript
import { NextResponse } from "next/server";

interface Post {
  id: number;
  title: string;
  body: string;
}

export async function GET() {
  const res = await fetch("https://jsonplaceholder.typicode.com/posts");
  const posts: Post[] = await res.json();

  return NextResponse.json(posts);
}
```

### 7. Ejecutar el Proyecto

```bash
cd mi-app-next
npm run dev
```

Abre `http://localhost:3000` para ver la aplicación.

### 8. Buenas Prácticas con Next.js y TypeScript

- **Usa `NextPage` para tipar páginas**: Mejora la claridad y el soporte del editor.
- **Define interfaces para props**: Por ejemplo, `CounterProps` en el componente `Counter`.
- **Aprovecha el alias `@/*`**: Simplifica las importaciones (por ejemplo, `import Counter from "@/components/Counter"`).
- **Habilita `strict` en `tsconfig.json`**: Detecta errores comunes como `null` o `undefined`.
- **Usa componentes de servidor cuando sea posible**: Reducen el JavaScript enviado al cliente.
- **Tipa las respuestas de API**: Usa interfaces para datos de API como `Post`.

### Ejemplo Práctico

Crea una página dinámica en `src/app/posts/[id]/page.tsx`:

```typescript
import { notFound } from "next/navigation";

interface Post {
  id: number;
  title: string;
  body: string;
}

interface Props {
  params: { id: string };
}

export default async function PostPage({ params }: Props) {
  const res = await fetch(`https://jsonplaceholder.typicode.com/posts/${params.id}`);
  if (!res.ok) notFound();

  const post: Post = await res.json();

  return (
    <div className="p-8">
      <h1 className="text-3xl font-bold">{post.title}</h1>
      <p>{post.body}</p>
    </div>
  );
}
```

Visita `http://localhost:3000/posts/1` para ver el post con ID 1.

