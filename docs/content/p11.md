# useContext - Compartir Estado Global en React

## ¬øQu√© es useContext?

El hook `useContext` nos permite **compartir datos entre componentes** sin tener que pasar props de padre a hijo en cada nivel. Es perfecto para datos que necesitan muchos componentes, como:

- Informaci√≥n del usuario logueado
- Tema de la aplicaci√≥n (claro/oscuro)
- Idioma seleccionado
- Carrito de compras

## Sintaxis B√°sica

```javascript
import { createContext, useContext } from 'react';

// 1. Crear el contexto
const MiContexto = createContext();

// 2. Usar el contexto en un componente
const valor = useContext(MiContexto);
```

## Importar useContext

```javascript
import { useContext, createContext } from 'react';
```

## Ejemplo B√°sico: Compartir un Mensaje

### Paso 1: Crear el Contexto

```javascript
import { createContext, useContext } from 'react';

// Crear el contexto
const MensajeContexto = createContext();

// Componente que proporciona el contexto
function ProveedorMensaje({ children }) {
  const mensaje = "¬°Hola desde el contexto!";
  
  return (
    <MensajeContexto.Provider value={mensaje}>
      {children}
    </MensajeContexto.Provider>
  );
}

// Componente que usa el contexto
function MostrarMensaje() {
  const mensaje = useContext(MensajeContexto);
  
  return (
    <div style={{ 
      padding: '20px', 
      backgroundColor: '#e3f2fd',
      borderRadius: '8px',
      margin: '10px'
    }}>
      <h3>Mensaje del contexto:</h3>
      <p>{mensaje}</p>
    </div>
  );
}

// Componente principal
function App() {
  return (
    <ProveedorMensaje>
      <div>
        <h1>Mi Aplicaci√≥n</h1>
        <MostrarMensaje />
      </div>
    </ProveedorMensaje>
  );
}

export default App;
```

## Ejemplo con Estado: Contador Global

```javascript
import { createContext, useContext, useState } from 'react';

// Crear el contexto
const ContadorContexto = createContext();

// Proveedor del contexto
function ProveedorContador({ children }) {
  const [contador, setContador] = useState(0);
  
  const incrementar = () => setContador(contador + 1);
  const decrementar = () => setContador(contador - 1);
  const reiniciar = () => setContador(0);
  
  return (
    <ContadorContexto.Provider value={{
      contador,
      incrementar,
      decrementar,
      reiniciar
    }}>
      {children}
    </ContadorContexto.Provider>
  );
}

// Componente que muestra el contador
function MostrarContador() {
  const { contador } = useContext(ContadorContexto);
  
  return (
    <div style={{
      fontSize: '24px',
      fontWeight: 'bold',
      textAlign: 'center',
      padding: '20px',
      backgroundColor: '#f5f5f5',
      borderRadius: '8px',
      margin: '10px'
    }}>
      Contador: {contador}
    </div>
  );
}

// Componente con botones
function BotonesContador() {
  const { incrementar, decrementar, reiniciar } = useContext(ContadorContexto);
  
  const estiloBoton = {
    padding: '10px 20px',
    margin: '5px',
    border: 'none',
    borderRadius: '5px',
    cursor: 'pointer',
    fontSize: '16px'
  };
  
  return (
    <div style={{ textAlign: 'center', margin: '20px' }}>
      <button 
        onClick={incrementar}
        style={{ ...estiloBoton, backgroundColor: '#4caf50', color: 'white' }}
      >
        +1
      </button>
      <button 
        onClick={decrementar}
        style={{ ...estiloBoton, backgroundColor: '#f44336', color: 'white' }}
      >
        -1
      </button>
      <button 
        onClick={reiniciar}
        style={{ ...estiloBoton, backgroundColor: '#2196f3', color: 'white' }}
      >
        Reiniciar
      </button>
    </div>
  );
}

// App principal
function App() {
  return (
    <ProveedorContador>
      <div style={{ maxWidth: '400px', margin: '0 auto', padding: '20px' }}>
        <h1 style={{ textAlign: 'center' }}>Contador Global</h1>
        <MostrarContador />
        <BotonesContador />
      </div>
    </ProveedorContador>
  );
}

export default App;
```

## Ejemplo Pr√°ctico: Sistema de Temas

```javascript
import { createContext, useContext, useState } from 'react';

// Crear el contexto de tema
const TemaContexto = createContext();

// Proveedor del tema
function ProveedorTema({ children }) {
  const [temaOscuro, setTemaOscuro] = useState(false);
  
  const cambiarTema = () => setTemaOscuro(!temaOscuro);
  
  const tema = {
    backgroundColor: temaOscuro ? '#333' : '#fff',
    color: temaOscuro ? '#fff' : '#333',
    minHeight: '100vh',
    padding: '20px'
  };
  
  return (
    <TemaContexto.Provider value={{ temaOscuro, cambiarTema, tema }}>
      <div style={tema}>
        {children}
      </div>
    </TemaContexto.Provider>
  );
}

// Componente header
function Header() {
  const { temaOscuro, cambiarTema } = useContext(TemaContexto);
  
  return (
    <header style={{
      display: 'flex',
      justifyContent: 'space-between',
      alignItems: 'center',
      padding: '20px',
      borderBottom: `2px solid ${temaOscuro ? '#555' : '#ddd'}`
    }}>
      <h1>Mi Aplicaci√≥n</h1>
      <button 
        onClick={cambiarTema}
        style={{
          padding: '10px 20px',
          border: 'none',
          borderRadius: '5px',
          backgroundColor: temaOscuro ? '#555' : '#007bff',
          color: 'white',
          cursor: 'pointer'
        }}
      >
        {temaOscuro ? '‚òÄÔ∏è Claro' : 'üåô Oscuro'}
      </button>
    </header>
  );
}

// Componente de contenido
function Contenido() {
  const { temaOscuro } = useContext(TemaContexto);
  
  return (
    <main style={{ padding: '20px' }}>
      <h2>Contenido Principal</h2>
      <p>
        Este es un ejemplo de c√≥mo usar useContext para manejar temas.
        El tema actual es: <strong>{temaOscuro ? 'Oscuro' : 'Claro'}</strong>
      </p>
      <div style={{
        padding: '15px',
        backgroundColor: temaOscuro ? '#444' : '#f8f9fa',
        borderRadius: '8px',
        marginTop: '20px'
      }}>
        <h3>Tarjeta de ejemplo</h3>
        <p>Esta tarjeta cambia de color seg√∫n el tema seleccionado.</p>
      </div>
    </main>
  );
}

// App principal
function App() {
  return (
    <ProveedorTema>
      <Header />
      <Contenido />
    </ProveedorTema>
  );
}

export default App;
```

## Ejemplo Avanzado: Sistema de Autenticaci√≥n

```javascript
import { createContext, useContext, useState } from 'react';

// Contexto de autenticaci√≥n
const AuthContexto = createContext();

// Proveedor de autenticaci√≥n
function ProveedorAuth({ children }) {
  const [usuario, setUsuario] = useState(null);
  const [cargando, setCargando] = useState(false);
  
  const iniciarSesion = async (email, password) => {
    setCargando(true);
    
    // Simular llamada a API
    setTimeout(() => {
      if (email === 'admin@test.com' && password === '123456') {
        setUsuario({
          id: 1,
          nombre: 'Juan P√©rez',
          email: email,
          rol: 'admin'
        });
      }
      setCargando(false);
    }, 1000);
  };
  
  const cerrarSesion = () => {
    setUsuario(null);
  };
  
  const estaLogueado = () => usuario !== null;
  
  return (
    <AuthContexto.Provider value={{
      usuario,
      cargando,
      iniciarSesion,
      cerrarSesion,
      estaLogueado
    }}>
      {children}
    </AuthContexto.Provider>
  );
}

// Componente de login
function FormularioLogin() {
  const { iniciarSesion, cargando } = useContext(AuthContexto);
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  
  const manejarSubmit = (e) => {
    e.preventDefault();
    iniciarSesion(email, password);
  };
  
  const estiloInput = {
    width: '100%',
    padding: '10px',
    margin: '10px 0',
    border: '1px solid #ddd',
    borderRadius: '4px',
    fontSize: '16px'
  };
  
  return (
    <form onSubmit={manejarSubmit} style={{
      maxWidth: '400px',
      margin: '50px auto',
      padding: '20px',
      border: '1px solid #ddd',
      borderRadius: '8px'
    }}>
      <h2 style={{ textAlign: 'center' }}>Iniciar Sesi√≥n</h2>
      
      <input
        type="email"
        placeholder="Email (admin@test.com)"
        value={email}
        onChange={(e) => setEmail(e.target.value)}
        style={estiloInput}
        required
      />
      
      <input
        type="password"
        placeholder="Contrase√±a (123456)"
        value={password}
        onChange={(e) => setPassword(e.target.value)}
        style={estiloInput}
        required
      />
      
      <button 
        type="submit" 
        disabled={cargando}
        style={{
          width: '100%',
          padding: '12px',
          backgroundColor: cargando ? '#ccc' : '#007bff',
          color: 'white',
          border: 'none',
          borderRadius: '4px',
          fontSize: '16px',
          cursor: cargando ? 'not-allowed' : 'pointer'
        }}
      >
        {cargando ? 'Iniciando...' : 'Iniciar Sesi√≥n'}
      </button>
    </form>
  );
}

// Componente del dashboard
function Dashboard() {
  const { usuario, cerrarSesion } = useContext(AuthContexto);
  
  return (
    <div style={{
      maxWidth: '600px',
      margin: '50px auto',
      padding: '20px',
      border: '1px solid #ddd',
      borderRadius: '8px'
    }}>
      <div style={{
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        marginBottom: '20px'
      }}>
        <h2>Dashboard</h2>
        <button 
          onClick={cerrarSesion}
          style={{
            padding: '8px 16px',
            backgroundColor: '#dc3545',
            color: 'white',
            border: 'none',
            borderRadius: '4px',
            cursor: 'pointer'
          }}
        >
          Cerrar Sesi√≥n
        </button>
      </div>
      
      <div style={{
        backgroundColor: '#f8f9fa',
        padding: '15px',
        borderRadius: '8px'
      }}>
        <h3>Bienvenido, {usuario.nombre}!</h3>
        <p><strong>Email:</strong> {usuario.email}</p>
        <p><strong>Rol:</strong> {usuario.rol}</p>
        <p><strong>ID:</strong> {usuario.id}</p>
      </div>
      
      <div style={{ marginTop: '20px' }}>
        <h4>Acciones disponibles:</h4>
        <ul>
          <li>Ver perfil</li>
          <li>Configurar cuenta</li>
          <li>Administrar usuarios</li>
        </ul>
      </div>
    </div>
  );
}

// Componente principal
function App() {
  const { estaLogueado } = useContext(AuthContexto);
  
  return (
    <div>
      {estaLogueado() ? <Dashboard /> : <FormularioLogin />}
    </div>
  );
}

// App con proveedor
function AppConAuth() {
  return (
    <ProveedorAuth>
      <App />
    </ProveedorAuth>
  );
}

export default AppConAuth;
```

## Reglas Importantes

### ‚úÖ Qu√© S√ç hacer:

1. **Crear el contexto fuera del componente**
```javascript
const MiContexto = createContext(); // ‚úÖ Correcto
```

2. **Usar el Provider para envolver componentes**
```javascript
<MiContexto.Provider value={datos}>
  <ComponenteHijo />
</MiContexto.Provider>
```

3. **Verificar que el componente est√© dentro del Provider**
```javascript
function MiComponente() {
  const datos = useContext(MiContexto);
  if (!datos) {
    throw new Error('MiComponente debe estar dentro del Provider');
  }
  return <div>{datos}</div>;
}
```

### ‚ùå Qu√© NO hacer:

1. **No crear el contexto dentro del componente**
```javascript
function MiComponente() {
  const MiContexto = createContext(); // ‚ùå Incorrecto
  // ...
}
```

2. **No usar useContext sin Provider**
```javascript
// ‚ùå Error: useContext sin Provider
function ComponenteSinProvider() {
  const datos = useContext(MiContexto); // undefined
  return <div>{datos}</div>;
}
```

## Casos de Uso Comunes

### 1. **Informaci√≥n del Usuario**
- Datos del perfil
- Preferencias
- Permisos

### 2. **Configuraci√≥n de la App**
- Tema (claro/oscuro)
- Idioma
- Configuraciones

### 3. **Estado Global**
- Carrito de compras
- Notificaciones
- Estado de carga

### 4. **Datos Compartidos**
- Lista de productos
- Configuraci√≥n de API
- Cache de datos

## Ejemplo: Carrito de Compras

```javascript
import { createContext, useContext, useState } from 'react';

// Contexto del carrito
const CarritoContexto = createContext();

// Proveedor del carrito
function ProveedorCarrito({ children }) {
  const [productos, setProductos] = useState([]);
  
  const agregarProducto = (producto) => {
    const existe = productos.find(p => p.id === producto.id);
    
    if (existe) {
      setProductos(productos.map(p => 
        p.id === producto.id 
          ? { ...p, cantidad: p.cantidad + 1 }
          : p
      ));
    } else {
      setProductos([...productos, { ...producto, cantidad: 1 }]);
    }
  };
  
  const removerProducto = (id) => {
    setProductos(productos.filter(p => p.id !== id));
  };
  
  const obtenerTotal = () => {
    return productos.reduce((total, p) => total + (p.precio * p.cantidad), 0);
  };
  
  const obtenerCantidadTotal = () => {
    return productos.reduce((total, p) => total + p.cantidad, 0);
  };
  
  return (
    <CarritoContexto.Provider value={{
      productos,
      agregarProducto,
      removerProducto,
      obtenerTotal,
      obtenerCantidadTotal
    }}>
      {children}
    </CarritoContexto.Provider>
  );
}

// Lista de productos disponibles
function ListaProductos() {
  const { agregarProducto } = useContext(CarritoContexto);
  
  const productosDisponibles = [
    { id: 1, nombre: 'Laptop', precio: 1000 },
    { id: 2, nombre: 'Mouse', precio: 25 },
    { id: 3, nombre: 'Teclado', precio: 75 }
  ];
  
  return (
    <div style={{ padding: '20px' }}>
      <h2>Productos Disponibles</h2>
      {productosDisponibles.map(producto => (
        <div key={producto.id} style={{
          display: 'flex',
          justifyContent: 'space-between',
          alignItems: 'center',
          padding: '10px',
          border: '1px solid #ddd',
          borderRadius: '5px',
          margin: '10px 0'
        }}>
          <div>
            <h4>{producto.nombre}</h4>
            <p>${producto.precio}</p>
          </div>
          <button 
            onClick={() => agregarProducto(producto)}
            style={{
              padding: '8px 16px',
              backgroundColor: '#28a745',
              color: 'white',
              border: 'none',
              borderRadius: '4px',
              cursor: 'pointer'
            }}
          >
            Agregar al Carrito
          </button>
        </div>
      ))}
    </div>
  );
}

// Carrito de compras
function Carrito() {
  const { productos, removerProducto, obtenerTotal, obtenerCantidadTotal } = useContext(CarritoContexto);
  
  if (productos.length === 0) {
    return (
      <div style={{ padding: '20px' }}>
        <h2>Carrito de Compras</h2>
        <p>El carrito est√° vac√≠o</p>
      </div>
    );
  }
  
  return (
    <div style={{ padding: '20px' }}>
      <h2>Carrito de Compras ({obtenerCantidadTotal()} items)</h2>
      
      {productos.map(producto => (
        <div key={producto.id} style={{
          display: 'flex',
          justifyContent: 'space-between',
          alignItems: 'center',
          padding: '10px',
          border: '1px solid #ddd',
          borderRadius: '5px',
          margin: '10px 0'
        }}>
          <div>
            <h4>{producto.nombre}</h4>
            <p>Cantidad: {producto.cantidad}</p>
            <p>Precio: ${producto.precio} c/u</p>
          </div>
          <div style={{ textAlign: 'right' }}>
            <p><strong>${producto.precio * producto.cantidad}</strong></p>
            <button 
              onClick={() => removerProducto(producto.id)}
              style={{
                padding: '5px 10px',
                backgroundColor: '#dc3545',
                color: 'white',
                border: 'none',
                borderRadius: '4px',
                cursor: 'pointer'
              }}
            >
              Remover
            </button>
          </div>
        </div>
      ))}
      
      <div style={{
        marginTop: '20px',
        padding: '15px',
        backgroundColor: '#f8f9fa',
        borderRadius: '8px',
        textAlign: 'right'
      }}>
        <h3>Total: ${obtenerTotal()}</h3>
      </div>
    </div>
  );
}

// App principal
function App() {
  return (
    <ProveedorCarrito>
      <div style={{ display: 'flex', maxWidth: '1200px', margin: '0 auto' }}>
        <div style={{ flex: 1 }}>
          <ListaProductos />
        </div>
        <div style={{ flex: 1 }}>
          <Carrito />
        </div>
      </div>
    </ProveedorCarrito>
  );
}

export default App;
```

## Consejos Pr√°cticos

### 1. **Organizar Contextos**
```javascript
// contexts/AuthContext.js
export const AuthContexto = createContext();
export const useAuth = () => useContext(AuthContexto);

// En el componente
import { useAuth } from './contexts/AuthContext';
const { usuario } = useAuth();
```

### 2. **M√∫ltiples Contextos**
```javascript
function App() {
  return (
    <ProveedorAuth>
      <ProveedorTema>
        <ProveedorCarrito>
          <MiApp />
        </ProveedorCarrito>
      </ProveedorTema>
    </ProveedorAuth>
  );
}
```

### 3. **Valores por Defecto**
```javascript
const MiContexto = createContext({
  usuario: null,
  tema: 'claro',
  idioma: 'es'
});
```

## Ejercicios Pr√°cticos

### Ejercicio 1: Sistema de Notificaciones
Crea un contexto que maneje notificaciones con:
- Agregar notificaci√≥n
- Remover notificaci√≥n
- Limpiar todas las notificaciones

### Ejercicio 2: Configuraci√≥n de Usuario
Implementa un contexto para:
- Preferencias de idioma
- Configuraci√≥n de notificaciones
- Tema personalizado

### Ejercicio 3: Lista de Tareas Global
Desarrolla un contexto que permita:
- Agregar tareas
- Marcar como completadas
- Filtrar por estado
- Contar tareas pendientes

## Errores Comunes y Soluciones

### Error 1: useContext devuelve undefined
```javascript
// ‚ùå Problema: Componente fuera del Provider
function MiComponente() {
  const datos = useContext(MiContexto); // undefined
  return <div>{datos}</div>;
}

// ‚úÖ Soluci√≥n: Envolver con Provider
<MiContexto.Provider value={datos}>
  <MiComponente />
</MiContexto.Provider>
```

### Error 2: Recrear el contexto en cada render
```javascript
// ‚ùå Problema: Contexto se recrea
function MiComponente() {
  const MiContexto = createContext(); // Se recrea cada vez
  // ...
}

// ‚úÖ Soluci√≥n: Crear fuera del componente
const MiContexto = createContext(); // Solo una vez

function MiComponente() {
  // ...
}
```

### Error 3: No memoizar el valor del Provider
```javascript
// ‚ùå Problema: Valor se recrea en cada render
function MiProvider({ children }) {
  const [estado, setEstado] = useState(0);
  
  return (
    <MiContexto.Provider value={{ estado, setEstado }}>
      {children}
    </MiContexto.Provider>
  );
}

// ‚úÖ Soluci√≥n: Usar useMemo
import { useMemo } from 'react';

function MiProvider({ children }) {
  const [estado, setEstado] = useState(0);
  
  const valor = useMemo(() => ({
    estado,
    setEstado
  }), [estado]);
  
  return (
    <MiContexto.Provider value={valor}>
      {children}
    </MiContexto.Provider>
  );
}
```

## Resumen

**useContext** es perfecto para:
- ‚úÖ Compartir datos entre muchos componentes
- ‚úÖ Evitar "prop drilling" (pasar props por muchos niveles)
- ‚úÖ Manejar estado global de la aplicaci√≥n
- ‚úÖ Configuraciones y preferencias

**Recuerda:**
1. Crear el contexto fuera del componente
2. Usar Provider para envolver componentes
3. Verificar que el componente est√© dentro del Provider
4. Organizar contextos en archivos separados
5. Memoizar valores complejos del Provider

¬°Con useContext puedes crear aplicaciones m√°s organizadas y f√°ciles de mantener!


