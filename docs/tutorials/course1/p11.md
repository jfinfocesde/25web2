# Archivos de Tipos y Tipos Globales en TypeScript

En TypeScript, los archivos de tipos (`.d.ts`) y los tipos globales son herramientas esenciales para definir tipos reutilizables, proporcionar tipado a bibliotecas externas y declarar variables o funciones accesibles globalmente. En esta sección, aprenderás cómo crear y usar archivos de tipos y tipos globales en tus proyectos.

## ¿Qué son los Archivos de Tipos?

Los archivos de tipos, con extensión `.d.ts`, son archivos que contienen únicamente declaraciones de tipos, interfaces, módulos y otros elementos de TypeScript, sin código ejecutable. Se utilizan para:

- Definir tipos para bibliotecas JavaScript sin tipado.
- Compartir tipos entre múltiples archivos en un proyecto.
- Mejorar la organización y reutilización de tipos complejos.

## Crear un Archivo de Tipos

### Ejemplo: Definir Tipos para una Biblioteca Externa

Supongamos que usas una biblioteca JavaScript sin tipado, como `mi-biblioteca`. Puedes crear un archivo de tipos para proporcionarle soporte de TypeScript.

1. **Crea un archivo `mi-biblioteca.d.ts` en `src/types/`**:

   ```typescript
   declare module "mi-biblioteca" {
     export function saludar(nombre: string): string;
     export const VERSION: string;
   }
   ```

   - `declare module` define un módulo externo.
   - Exportamos una función `saludar` y una constante `VERSION`.

2. **Usa la biblioteca en tu código**:

   ```typescript
   // src/index.ts
   import { saludar, VERSION } from "mi-biblioteca";

   console.log(saludar("Ana")); // Hola, Ana
   console.log(VERSION); // 1.0.0
   ```

   TypeScript ahora reconoce los tipos de `mi-biblioteca` sin errores.

### Ejemplo: Tipos Reutilizables

Crea un archivo de tipos para estructuras compartidas en tu proyecto.

1. **Crea `src/types/models.d.ts`**:

   ```typescript
   export interface Usuario {
     id: number;
     nombre: string;
     email: string;
   }

   export interface Producto {
     id: number;
     nombre: string;
     precio: number;
   }
   ```

2. **Importa los tipos en otros archivos**:

   ```typescript
   // src/index.ts
   import { Usuario, Producto } from "./types/models";

   const usuario: Usuario = {
     id: 1,
     nombre: "Juan",
     email: "juan@example.com",
   };

   const producto: Producto = {
     id: 1,
     nombre: "Laptop",
     precio: 1000,
   };

   console.log(usuario, producto);
   ```

3. **Configura `tsconfig.json`** para incluir los archivos de tipos:

   ```json
   {
     "compilerOptions": {
       "typeRoots": ["./src/types", "./node_modules/@types"],
       "strict": true
     }
   }
   ```

   Esto asegura que TypeScript busque archivos `.d.ts` en `src/types`.

## Tipos Globales

Los tipos globales permiten declarar variables, funciones o interfaces que están disponibles en todo el proyecto sin necesidad de importarlas. Son útiles para:

- Definir variables globales como `window.miVariable`.
- Extender interfaces globales como `Window` o `globalThis`.
- Proporcionar tipos para entornos específicos (por ejemplo, Node.js o navegadores).

### Ejemplo: Declarar una Variable Global

Supongamos que tienes una variable global `CONFIG` inyectada en el navegador.

1. **Crea `src/types/globals.d.ts`**:

   ```typescript
   interface Config {
     apiUrl: string;
     debug: boolean;
   }

   declare global {
     var CONFIG: Config;
   }
   ```

   - `declare global` extiende el ámbito global.
   - Declaramos `CONFIG` como una variable global con tipo `Config`.

2. **Usa la variable global**:

   ```typescript
   // src/index.ts
   console.log(CONFIG.apiUrl); // https://api.example.com
   console.log(CONFIG.debug); // true
   ```

   No necesitas importar nada; TypeScript reconoce `CONFIG` globalmente.

### Ejemplo: Extender la Interfaz `Window`

Para añadir propiedades personalizadas a `window`, usa `declare global`.

1. **Edita `src/types/globals.d.ts`**:

   ```typescript
   declare global {
     interface Window {
       miFuncionPersonalizada: (mensaje: string) => void;
     }
   }
   ```

2. **Usa la propiedad en tu código**:

   ```typescript
   // src/index.ts
   window.miFuncionPersonalizada("Hola"); // Válido
   ```

### Ejemplo: Tipos Globales en Node.js

Para declarar una variable global en un entorno Node.js, como `process.env.MI_VARIABLE`:

1. **Crea `src/types/env.d.ts`**:

   ```typescript
   declare global {
     namespace NodeJS {
       interface ProcessEnv {
         MI_VARIABLE: string;
       }
     }
   }
   ```

2. **Usa la variable**:

   ```typescript
   // src/index.ts
   console.log(process.env.MI_VARIABLE); // Valor de la variable de entorno
   ```

## Usar Tipos de Bibliotecas Existentes (@types)

Muchas bibliotecas JavaScript tienen tipados oficiales en el paquete `@types`. Por ejemplo, para `lodash`:

1. **Instala los tipos**:

   ```bash
   npm install --save-dev @types/lodash
   ```

2. **Usa la biblioteca con tipado**:

   ```typescript
   // src/index.ts
   import _ from "lodash";

   const numeros = [1, 2, 3, 4];
   console.log(_.chunk(numeros, 2)); // [[1, 2], [3, 4]]
   ```

   TypeScript usa automáticamente los tipos de `@types/lodash`.

## Buenas Prácticas

- **Organiza tus tipos**: Usa una carpeta `src/types/` para archivos `.d.ts`.
- **Evita `any` en archivos de tipos**: Sé específico para maximizar la seguridad.
- **Usa `export` en `.d.ts` para reutilización**: Permite importar tipos en otros archivos.
- **Minimiza los tipos globales**: Prefiere módulos para evitar colisiones.
- **Documenta tus tipos**: Usa comentarios JSDoc para claridad.

   ```typescript
   /**
    * Representa un usuario del sistema.
    */
   export interface Usuario {
     id: number;
     nombre: string;
     email: string;
   }
   ```

- **Mantén `typeRoots` actualizado**: Asegúrate de que TypeScript encuentre tus archivos de tipos.

## Ejemplo Práctico

Crea un proyecto con tipos globales y archivos de tipos:

1. **Configura la estructura**:

   ```
   proyecto/
   ├── src/
   │   ├── types/
   │   │   ├── models.d.ts
   │   │   ├── globals.d.ts
   │   ├── index.ts
   ├── tsconfig.json
   ├── package.json
   ```

2. **Crea `src/types/models.d.ts`**:

   ```typescript
   /**
    * Tipos para entidades del proyecto.
    */
   export interface Proyecto {
     id: number;
     nombre: string;
     activo: boolean;
   }
   ```

3. **Crea `src/types/globals.d.ts`**:

   ```typescript
   declare global {
     var APP_VERSION: string;
   }
   ```

4. **Escribe `src/index.ts`**:

   ```typescript
   import { Proyecto } from "./types/models";

   const proyecto: Proyecto = {
     id: 1,
     nombre: "Sistema de Gestión",
     activo: true,
   };

   console.log(proyecto);
   console.log(APP_VERSION); // Por ejemplo, "1.0.0"
   ```

5. **Actualiza `tsconfig.json`**:

   ```json
   {
     "compilerOptions": {
       "target": "es2020",
       "module": "commonjs",
       "outDir": "./dist",
       "rootDir": "./src",
       "strict": true,
       "typeRoots": ["./src/types", "./node_modules/@types"]
     }
   }
   ```

6. **Compila y ejecuta**:

   ```bash
   npx tsc
   node dist/index.js
   ```

